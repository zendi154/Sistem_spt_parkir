<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Arsip Surat Notaris / PPAT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, Arial, sans-serif;
            background: #0f172a;
            color: #fff;
        }

        /* ===== NAVBAR ===== */
        .navbar {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #2563eb, #1e40af);
            padding: 10px 16px;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            user-select: none;
        }

        .navbar i {
            font-size: 20px;
        }

        .navbar:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #1d4ed8, #1e3a8a);
        }

        .navbar:active {
            transform: scale(0.97);
        }

        /* ===== HEADER STICKY ===== */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #020617;
            padding: 20px;
            border-bottom: 1px solid #1e293b;
        }

        h2 {
            margin: 0 0 15px;
            text-align: center;
        }

        /* ===== CONTENT ===== */
        .content {
            padding: 20px;
        }

        /* ===== FORM ===== */
        form {
            background: #020617;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .input-group {
            position: relative;
            margin-top: 18px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 40px;
            border-radius: 8px;
            border: 1px solid #334155;
            background: transparent;
            color: #fff;
            outline: none;
        }

        .input-group i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }

        .input-group label {
            position: absolute;
            left: 40px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            color: #94a3b8;
            background: #020617;
            padding: 0 6px;
            pointer-events: none;
            transition: .25s;
        }

        .input-group input:focus+label,
        .input-group input:not(:placeholder-shown)+label {
            top: -8px;
            font-size: 12px;
            color: #22c55e;
        }

        .input-group select {
            width: 100%;
            padding: 12px 40px;
            border-radius: 8px;
            border: 1px solid #334155;
            background: #020617;
            color: #fff;
            outline: none;
            appearance: none;
            cursor: pointer;
        }

        .input-group select:focus {
            border-color: #22c55e;
        }

        .input-group select:focus+label,
        .input-group select:not([value=""])+label {
            top: -8px;
            font-size: 12px;
            color: #22c55e;
        }

        /* ===== AUTOCOMPLETE ===== */
        .autocomplete {
            position: absolute;
            width: 100%;
            background: #020617;
            border: 1px solid #334155;
            border-radius: 8px;
            margin-top: 6px;
            z-index: 999;
            max-height: 220px;
            overflow-y: auto;
        }

        .autocomplete div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #1e293b;
        }

        .autocomplete div:hover {
            background: #1e293b;
        }

        .autocomplete span {
            color: #22c55e;
            font-weight: bold;
        }

        /* ===== BUTTON ===== */
        button {
            margin-top: 15px;
            padding: 10px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-save {
            background: #22c55e;
            color: #020617;
        }

        .btn-delete {
            background: #ef4444;
            color: #fff;
        }

        .btn-print {
            background: #38bdf8;
            color: #020617;
        }

        /* ===== FILTER ===== */
        .filter-box {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-box input {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #334155;
            background: #020617;
            color: #fff;
        }

        /* ===== TABLE ===== */
        .table-wrapper {
            max-height: 60vh;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #020617;
        }

        th,
        td {
            border: 1px solid #1e293b;
            padding: 10px;
            text-align: center;
            font-size: 14px;
        }

        th {
            background: #1e293b;
            position: sticky;
            top: 0;
            z-index: 5;
        }

        .btn-edit {
            background: #38bdf8;
            color: #000;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 4px;
        }

        .btn-edit:hover {
            background: #0ea5e9;
        }

        /* ===== BUTTON LOADING ===== */
        .btn-loading {
            display: none;
        }

        .btn-save.loading .btn-text {
            display: none;
        }

        .btn-save.loading .btn-loading {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        /* ===== ALERT SUCCESS ===== */
        .alert-success {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #16a34a;
            color: white;
            padding: 12px 18px;
            border-radius: 8px;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, .3);
            animation: slideIn .4s ease;
            z-index: 9999;
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid #fff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ===== PRINT MODE ===== */
        @media print {

            body {
                background: #fff;
                color: #000;
            }

            /* sembunyikan semua */
            body * {
                visibility: hidden;
            }

            /* tampilkan tabel saja */
            table,
            table * {
                visibility: visible;
            }

            /* posisikan tabel ke atas */
            table {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: #fff;
                color: #000;
            }

            /* sembunyikan kolom aksi */
            th:last-child,
            td:last-child {
                display: none;
            }

            /* border hitam saat print */
            th,
            td {
                border: 1px solid #000;
                color: #000;
            }

            th {
                background: #f0f0f0;
            }
        }
    </style>
</head>

<body>
    <header class="app-header">
        <h2>TANDA TERIMA LAPORAN BULAN NOTARIS DAN PPAT KOTA BENGKULU</h2>

        <div id="loading" class="loading-overlay">
            <div class="loader"></div>
            <p>Memuat...</p>
        </div>

        <!-- NAVBAR -->
        <div class="navbar" onclick="goBack()">
            <i class="bi bi-receipt-cutoff"></i>
            <span>Fomulir Laporan Bulanan PPAT</span>
        </div>

        <form id="formSurat">
            <div class="input-group">
                <i class="fa-solid fa-user-tie"></i>
                <input type="text" id="nama_notaris" autocomplete="off" placeholder=" ">
                <label>Nama Notaris / PPAT</label>
                <div id="suggestions" class="autocomplete"></div>
            </div>

            <div class="input-group">
                <i class="fa-solid fa-calendar-days" id="iconTanggal"></i>
                <input type="date" id="tanggal_surat" required>
                <label>Tanggal Surat</label>
            </div>
            <div class="input-group">
                <i class="fa-solid fa-calendar-days" id="iconTanggal"></i>
                <input type="date" id="tanggal_diterima" required>
                <label>Tanggal Diterima</label>
            </div>

            <div class="input-group">
                <i class="fa-solid fa-file-lines"></i>

                <select id="judul_surat" required>
                    <option value="" disabled selected hidden>Pilih Judul Surat</option>

                    <option value="Surat Permohonan">Surat Permohonan</option>
                    <option value="Surat Kuasa">Surat Kuasa</option>
                    <option value="Surat Pernyataan">Surat Pernyataan</option>
                    <option value="Surat Keterangan">Surat Keterangan</option>
                    <option value="Surat Undangan">Surat Undangan</option>
                    <option value="Surat Pemberitahuan">Surat Pemberitahuan</option>
                    <option value="Surat Pengantar">Surat Pengantar</option>
                    <option value="Laporan Bulanan PPAT">Laporan Bulanan PPAT</option>
                </select>

                <label></label>
            </div>
            <div class="input-group">
                <i class="fa-solid fa-file-lines"></i>

                <select id="dari_bidang" required>
                    <option value="" disabled selected hidden>Pilih Bidang Dibawah ini</option>

                    <option value="Sekretariat">Sekre</option>
                    <option value="Bidang Perencanan dan Pengembangan Pendapatan Daerah"> Bidang P1</option>
                    <option value="Bidang Pengelolan dan Pendapatan Daerah"> Bidang P2</option>
                    <option value="Bidang Pengendalian dan Evaluasi Daerah"> Bidang P3</option>
                </select>

                <label></label>
            </div>

            <div class="input-group">
                <i class="fa-solid fa-user"></i>
                <input type="text" id="nama_penerima" placeholder=" ">
                <label>Nama Pengantar</label>
            </div>

            <button class="btn-save" id="btnSave">
                <span class="btn-text">
                    <i class="fa-solid fa-paper-plane"></i> Simpan Data
                </span>
                <span class="btn-loading">
                    <i class="fa-solid fa-spinner fa-spin"></i> Menyimpan...
                </span>
            </button>

            <div id="alertSuccess" class="alert-success">
                <i class="fa-solid fa-circle-check"></i>
                Data berhasil disimpan
            </div>

            <div class="filter-box">
                <i class="fa-solid fa-filter"></i>

                <input type="text" id="filterNama" placeholder="Filter Nama Notaris / PPAT">

                <input type="date" id="filterTanggal">

                <button class="btn-print" onclick="printData()">
                    <i class="fa-solid fa-print"></i> Print
                </button>
            </div>

            </div>
    </header>

    <main class="content">
        <div class="table-wrapper">
            <table id="tabelSurat">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama Notaris / PPAT</th>
                        <th>Tanggal Surat</th>
                        <th>Tanggal Diterima</th>
                        <th>Judul Surat</th>
                        <th>Jam Diterima</th>
                        <th>Dari Bidang</th>
                        <th>Nama Pengantar</th>
                        <th>Paraf</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </main>

    <script>
        let editIndex = null;

        // hapus otomatis data lama
        localStorage.removeItem("list_notaris");

        function getNotaris() {
            return JSON.parse(localStorage.getItem(NOTARIS_KEY)) || defaultNotaris;
        }

        /* ================== KONSTANTA ================== */
        const STORAGE_KEY = "arsip_surat";
        const NOTARIS_KEY = "list_notaris";
        const filterNama = document.getElementById("filterNama") || { value: "" };

        /* ================== ELEMENT ================== */
        const namaInput = document.getElementById("nama_notaris");
        const suggestions = document.getElementById("suggestions");
        const tbody = document.querySelector("#tabelSurat tbody");
        const form = document.getElementById("formSurat");
        const filterTanggal = document.getElementById("filterTanggal");

        const tanggalSurat = document.getElementById("tanggal_surat");
        const tanggalDiterima = document.getElementById("tanggal_diterima");
        const iconTanggalSurat = document.getElementById("iconTanggalSurat");
        const iconTanggalDiterima = document.getElementById("iconTanggalDiterima");

        /* ================== DATA DEFAULT NOTARIS ================== */
        const defaultNotaris = [
            "AMELIA MERDEKA SARI, S.H., M.Kn",
            "ANJAR KRISTIANTO, S.H., M.Kn",
            "ATMIWIJAYA ARTATI, S.H., M.Kn",
            "ANGGA PRISMA JELITA, S.H.,M.Kn",
            "ANNISA FADILLA KARTAMADJA,S.H., M.Kn",
            "AULIYYA MARTATI, S.H., M.H",
            "ARDANA RESTIKA, S.H.,M.Kn",
            "AZIZA ADLIEN NABILA, S.H.,M.Kn",
            "BERTHA NOVELISA, S.H., M.Kn",
            "BJANZA METRA, S.H.,M.Kn",
            "BELLA FILDA AGATHA,S.H.,M.Kn",
            "CHRISTINE, S.H.,M.Kn",
            "DENI YOHANES, S.H., M.Kn",
            "DAUD WIDYA PRANATA SEPTI, S.H.,M.Kn",
            "DENI KRISTIAN NATANAEL, S.H,.M.Kn",
            "DESRIANO INDRA SYAHPUTRA, S.H.,M.Kn",
            "DORA YULIA AGUSTINA, S.H.,M.Kn",
            "DWI FANI ARSIKASINDI, S.H.,M.H",
            "EMY EFRIANTI AGUSTINI, S.H., M.Kn",
            "HARITRI GRATA JOHNI ARIFIN PUTRI, S.H., M.Kn",
            "HELEN SAPARINGGA,S.H., M.Kn",
            "H. EPISON, S.H",
            "H. MUFTI NOKHMAN, S.H.,M.Kn",
            "IDAYANTI, S.H",
            "IS HARIYANI,S.H",
            "ILHAM RAHMADI, SH",
            "INDAH ARIESTIA, S.H",
            "IRAWAN, S.H",
            "JULIWATI SIAGIAN, S.H,M.Kn",
            "KARTINI KESUMAWATY,S.H,.M.Kn",
            "KHAIRUNNISA, S.H., M.Kn",
            "KUSWARI, S.H",
            "LYDIA ARMAN, S.H., M.Kn",
            "LINDA OKTARINA, S.H",
            "MIRZA, S.H.,M.Kn",
            "NOVIARTATI, S.H",
            "RANDI WIBOWO, S.H.,M.Kn",
            "RIZFITRIANI ALAMSYAH, S.H.,M.Kn",
            "SARI PRIYANKA, S.H., M.Kn",
            "SUSANTI, S.H., M.Kn",
            "SARI INDRA, S.H.,M.Kn",
            "SHINTA WIDYANIATI, S.H.,M.Kn",
            "SICILIA HENDRA, S.H.,M.Kn",
            "SHABRINA ZHAFIRA,S.H.,M.Kn",
            "SISKA WIDIA ASTUTI, S.H.,M.Kn",
            "TINA HAERANI BUNGGASI, S.H.,M.Kn",
            "TIARA YUNITA OVELIA, S.H.,M.Kn",
            "VIKE DIANTI PUTRI, S.H.,M.Kn",
            "VINANDA LOVITA, S.H.,M.Kn",
            "WENY ARIMBI CRISTIANI,SST,Par.,S.H.,M.Kn"
        ];

        /* ================== STORAGE ================== */
        function getNotaris() {
            return JSON.parse(localStorage.getItem(NOTARIS_KEY)) || defaultNotaris;
        }

        function getData() {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        }

        function saveData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        /* ================== AUTOCOMPLETE NOTARIS ================== */
        namaInput.addEventListener("input", () => {
            const keyword = namaInput.value.trim().toLowerCase();
            suggestions.innerHTML = "";

            if (!keyword) {
                suggestions.style.display = "none";
                return;
            }

            const hasil = getNotaris().filter(nama =>
                nama.toLowerCase().includes(keyword)
            );

            hasil.forEach(nama => {
                const div = document.createElement("div");

                const regex = new RegExp(`(${keyword})`, "gi");
                div.innerHTML = nama.replace(regex, "<span>$1</span>");

                div.onclick = () => {
                    namaInput.value = nama;
                    suggestions.style.display = "none";
                };

                suggestions.appendChild(div);
            });

            suggestions.style.display = hasil.length ? "block" : "none";
        });

        /* Tutup autocomplete saat klik luar */
        document.addEventListener("click", e => {
            if (!e.target.closest(".input-group")) {
                suggestions.style.display = "none";
            }
        });

        /* ================== SUBMIT FORM ================== */
        form.addEventListener("submit", e => {
            e.preventDefault();

            // LOADING ON
            btnSave.classList.add("loading");
            btnSave.disabled = true;

            setTimeout(() => {
                const data = getData();

                const payload = {
                    nama: nama_notaris.value,
                    tanggal_surat: tanggalSurat.value,
                    tanggal_diterima: tanggalDiterima.value,
                    judul: judul_surat.value,
                    jam: new Date().toLocaleTimeString("id-ID"),
                    dari_bidang: dari_bidang.value,
                    penerima: nama_penerima.value
                };

                if (editIndex !== null) {
                    data[editIndex] = payload;
                    editIndex = null;
                } else {
                    data.push(payload);
                }

                saveData(data);
                form.reset();
                setTanggalHariIni();
                render();

                // LOADING OFF
                btnSave.classList.remove("loading");
                btnSave.disabled = false;

                // ALERT SUCCESS
                alertSuccess.style.display = "flex";

                setTimeout(() => {
                    alertSuccess.style.display = "none";
                }, 2000);

            }, 900);
        });


        /* ================== RENDER TABLE ================== */
        function render() {
            tbody.innerHTML = "";

            const filterTgl = filterTanggal.value;
            const filterNm = filterNama ? filterNama.value.toLowerCase() : "";

            getData().forEach((d, i) => {

                if (filterTgl && d.tanggal_surat !== filterTgl) return;
                if (filterNm && !d.nama.toLowerCase().includes(filterNm)) return;

                tbody.innerHTML += `
        <tr>
            <td>${i + 1}</td>
            <td>${d.nama}</td>
            <td>${d.tanggal_surat}</td>
            <td>${d.tanggal_diterima}</td>
            <td>${d.judul}</td>
            <td>${d.jam}</td>
            <td>${d.dari_bidang}</td>
            <td>${d.penerima}</td>
            <td></td>
            <td>
                <button class="btn-edit" onclick="editData(${i})">
                    <i class="fa-solid fa-pen"></i>
                </button>
                <button class="btn-delete" onclick="hapus(${i})">
                    <i class="fa-solid fa-trash"></i>
                </button>
            </td>
        </tr>`;
            });
        }

        function editData(index) {
            const data = getData()[index];

            nama_notaris.value = data.nama;
            tanggalSurat.value = data.tanggal_surat;
            tanggalDiterima.value = data.tanggal_diterima;
            judul_surat.value = data.judul;
            dari_bidang.value = data.dari_bidang;
            nama_penerima.value = data.penerima;

            editIndex = index;

            document.querySelector(".btn-text").innerHTML =
                `<i class="fa-solid fa-floppy-disk"></i> Update Data`;
        }

        filterTanggal.addEventListener("change", render);
        filterNama.addEventListener("input", render);

        /* ================== HAPUS DATA ================== */
        function hapus(index) {
            if (!confirm("Yakin ingin menghapus data ini?")) return;
            const data = getData();
            data.splice(index, 1);
            saveData(data);
            render();
        }

        /* ================== FILTER TANGGAL ================== */
        filterTanggal.addEventListener("change", render);

        /* ================== PRINT ================== */
        function printData() {
            window.print();
        }

        /* ================== TANGGAL OTOMATIS ================== */
        function setTanggalHariIni() {
            const today = new Date().toISOString().split("T")[0];

            if (!tanggalSurat.value) tanggalSurat.value = today;
            if (!tanggalDiterima.value) tanggalDiterima.value = today;
        }

        setTanggalHariIni();

        /* klik icon = buka kalender */
        iconTanggal.addEventListener("click", () => {
            tanggalInput.showPicker();
        });


        /* Klik icon / input buka date picker */
        iconTanggalSurat.addEventListener("click", () => tanggalSurat.showPicker());
        iconTanggalDiterima.addEventListener("click", () => tanggalDiterima.showPicker());

        /* ================== INIT ================== */
        render();

        function goBack() {
            const loading = document.getElementById("loading");

            if (loading) {
                loading.style.display = "flex";
            }

            setTimeout(() => {
                window.location.href = "datajukir.html";
            }, 1200);
        }

        document.addEventListener("contextmenu", e => e.preventDefault());

        (function () {
            const threshold = 160;
            setInterval(() => {
                const widthDiff = window.outerWidth - window.innerWidth;
                const heightDiff = window.outerHeight - window.innerHeight;

                if (widthDiff > threshold || heightDiff > threshold) {
                    document.body.innerHTML = `
                    <div style="
                        display:flex;
                        justify-content:center;
                        align-items:center;
                        height:100vh;
                        background:#020617;
                        color:#fff;
                        font-size:22px;
                        font-family:Arial;
                        text-align:center;
                    ">
                        ðŸš« Akses Diblokir <br>
                        Developer Tools terdeteksi
                    </div>
                `;
                }
            }, 1000);
        })();
    </script>


</body>

</html>
